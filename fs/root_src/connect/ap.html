<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Stand-alone setup.</title>
<link href="css/normalize.css" rel="stylesheet" type="text/css" />
<link href="css/custom.css" rel="stylesheet" type="text/css" />
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
</head>
<body>
	<nav role="navigation">
		<a href="#" class="hidden-menu" onclick="ToggleHide('menu');" id="hidden-menu">&#9776;</a>
		<ul id="menu">
			<li><a href="index.html" class="menu">WIFISwitch</a></li>
			<li><a href="net.html" class="menu">Network</a></li>
			<li><a href="ap.html" class="menu">Stand-alone</a></li>
			<li><a href="restart.html" class="menu">Restart</a></li>			
			<li><a href="about.html" class="menu">About</a></li>
		</ul>
	</nav>
	<section>
		<h3>Stand-alone  connection setup.</h3>
		<p>Network name:<br />
		<input type="text" id="ssid" maxlength="32"></p>
		<p>Channel:<br />
		<select id="channel">
		</select>
		<p>Password:<br />
		<input type="password" id="passwd" maxlength="64"></p>
		<p>Hostname:<br />
		<input type="text" id="hostname" maxlength="32"></p>
		<p><button type="button" onclick="setAP()">Save</button></p>
		<p class="message" id="status">
		</p>
		<br />
	</section>
	<footer class="inverted">
		<small><span class="copyright">&copy; Copyright 2015 Martin Bo Kristensen Gr&oslash;nholdt.</span><a href="LICENSE.zip" class="license inverted">Read license (compressed).</a></small>
	</footer>
	<script src="js/menu.js" type="text/javascript"></script>
	<script type="text/javascript">
        var socket = new WebSocket("ws://localhost:8080", "wifiswitch");
        var statusMsg = document.getElementById("status");
        
        statusMsg.innerHTML = "Connecting...</strong>";
        
        function populateChannels() {
			var channelSelect = document.getElementById("channel");

			for (var i = 1; i < 13; i++) {
				channelSelect.options[i - 1] = new Option(
						i, i, false, false);
			}
		}
        
        socket.onopen = function(event) {
			console.log("Connected to backend");
			
			socket.send(JSON.stringify({type: "ap"}));
			populateChannels();
			
			statusMsg.className = "message success";
			statusMsg.innerHTML = "<strong>Connected.</strong>";
        };
        
        // Display messages received from the server
        socket.onmessage = function(event) {
			console.log("Backend message:" + event.data);
			
			var msg = JSON.parse(event.data);
			if (msg.type === "ap") {
				document.getElementById("ssid").value = msg.ssid;
				document.getElementById("channel").value = msg.channel;
				document.getElementById("hostname").value = msg.hostname;
				statusMsg.className = "message success";
				statusMsg.innerHTML = "<strong>Updated.</strong>";
			}
        };

        // Display any errors that occur
        socket.onerror = function(event) {
			console.log("Backend error:" + event);
			statusMsg.className += "message error";
			statusMsg.innerHTML = "<strong>Error:</strong> " + event;
        };
        
        function setAP() {
			var passwd = document.getElementById("passwd").value;
			var msg = {};
			
			msg.type = "ap";
			msg.ssid = document.getElementById("ssid").value;
			msg.hostname = document.getElementById("hostname").value;
			msg.channel = parseInt(document.getElementById("channel").value);
			if (passwd) {
				msg.passwd = passwd;
			}

			socket.send(JSON.stringify(msg));
			statusMsg.className = "message";
			statusMsg.innerHTML = "<strong>Saving.</strong>";			
		}
	</script>
	<noscript>Sorry I need JavaScript!</noscript>
</body>
<html></html>
