<!DOCTYPE html><head>
<title>Network connection setup.</title>
<link href="css/min.css" rel="stylesheet" type="text/css" />
</head>
<body>
<h1>Network connection setup</h1>
<p>Current configured network: </p>
<form action="/ap_set.html" method="POST">
Networks: 
<select id="networks">
<option value="nets" class="smooth">Networks...</option>
</select>
</form>
<p id="json"></p>
<script src="js/atomic.min.js"></script>
<script>
	
var done = false;
var pending = false;

function populateNetworks(networks)
{
	var netSelect = document.getElementById("networks");
	
	netSelect.options.length = 0;
	
	if (networks.length === 0)
	{
		netSelect.options[netSelect.options.length] = new Option("Scanning...", "", false, false);
		return;
	}
	for (var i = 0; i < networks.length; i++)
	{
		netSelect.options[netSelect.options.length] = new Option(networks[i], networks[i], false, false);
	}
}
	
function getNetworks()
{
	pending = true;
	atomic.get('/rest/net/networks')
	.success(function (data, xhr) 
	{
		populateNetworks(data);
		done = true;
		pending = false;
	})
	.error(function (data, xhr) 
	{
		populateNetworks(new Array("Error..."));
		pending = false;
	});
}

function retryGet()
{
	var data = getNetworks();
	
	if (!done && !pending)
	{
		setTimeout(retryGet, 2000);
	}
}
	
retryGet();
</script>
</body>
</html>
